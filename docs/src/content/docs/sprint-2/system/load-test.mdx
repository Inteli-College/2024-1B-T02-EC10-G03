---
title: Testes de Carga
description: Testes de Carga utilizando o Framework TypeScript k6
---

# Testes de Carga utilizando o Framework TypeScript k6

## Introdu√ß√£o

Os testes de carga s√£o essenciais para garantir que um sistema possa lidar com a demanda esperada de usu√°rios e transa√ß√µes, sem comprometer sua performance, estabilidade ou seguran√ßa. Nesta documenta√ß√£o, exploraremos o que s√£o testes de carga, sua import√¢ncia para decis√µes arquiteturais do sistema, e como o framework TypeScript k6 pode ser utilizado para implement√°-los.

## O que s√£o testes de carga?

Testes de carga s√£o uma forma de avaliar o comportamento de um sistema sob condi√ß√µes de carga simuladas, onde a carga pode representar o n√∫mero de usu√°rios simult√¢neos, transa√ß√µes por segundo, volume de dados, entre outros. O objetivo principal √© identificar poss√≠veis gargalos, falhas de performance e determinar a capacidade m√°xima do sistema.

## Import√¢ncia para decis√µes arquiteturais do sistema

Os testes de carga desempenham um papel crucial na defini√ß√£o da arquitetura do sistema, pois fornecem insights valiosos sobre o desempenho e escalabilidade da aplica√ß√£o. Com base nos resultados dos testes de carga, os arquitetos de sistemas podem:

    - Identificar e mitigar poss√≠veis gargalos de performance.
    - Dimensionar adequadamente os recursos necess√°rios, como servidores, bancos de dados e redes.
    - Validar se as tecnologias e frameworks escolhidos s√£o adequados para lidar com a carga prevista.
    - Projetar estrat√©gias de escalabilidade horizontal ou vertical conforme necess√°rio.
    - Estimar os custos operacionais associados √† infraestrutura de hospedagem e manuten√ß√£o do sistema.

## O framework TypeScript k6

O k6 √© uma ferramenta de teste de carga de c√≥digo aberto e oferece suporte para scripts escritos em JavaScript ou TypeScript. Ele se destaca por sua simplicidade de uso, efici√™ncia e capacidade de execu√ß√£o de testes distribu√≠dos.
Caracter√≠sticas principais do k6:

    - JavaScript/TypeScript: Permite escrever scripts de teste utilizando a linguagem familiar JavaScript ou TypeScript, o que facilita a integra√ß√£o com outras ferramentas e frameworks.
    - Sintaxe Limpa: Possui uma sintaxe limpa e f√°cil de entender, o que simplifica a cria√ß√£o e manuten√ß√£o de scripts de teste.
    - Suporte a HTTP/HTTPS: Oferece suporte nativo para testes de carga em aplica√ß√µes web, permitindo simular requisi√ß√µes HTTP/HTTPS e analisar o desempenho do servidor.
    - M√©tricas e Thresholds: Permite definir m√©tricas de desempenho e thresholds para avaliar se o sistema atende aos requisitos de performance estabelecidos.
    - Execu√ß√£o Distribu√≠da: Capacidade de distribuir a execu√ß√£o de testes em v√°rios n√≥s, facilitando a simula√ß√£o de grandes volumes de usu√°rios.
    - Integra√ß√£o com CI/CD: Pode ser facilmente integrado a pipelines de CI/CD para automatizar a execu√ß√£o de testes de carga em cada vers√£o do sistema.

## Exemplo de script de teste utilizando k6 (TypeScript)

Aqui est√° um exemplo de script de teste de carga escrito em TypeScript utilizando o framework k6:

```typescript

import http from 'k6/http';
import { sleep, randomIntBetween } from 'k6';

export const options = {
    thresholds: {
        http_req_failed: ['rate<0.05'],
        http_req_duration: ['p(95)<300'],
    },
    vus: 10,
    duration: '30s',
};

export default function () {
    const baseUrl = 'http://localhost:3000';

    http.get(baseUrl);
    http.get(baseUrl + '/pyxis');
    http.get(baseUrl + '/catalog');

    const pyxisPayload = JSON.stringify({ floor: randomIntBetween(1, 11), block: 'exampleBlock' });
    http.post(baseUrl + '/pyxis', pyxisPayload, { headers: { 'Content-Type': 'application/json' } });

    const catalogPayload = JSON.stringify({ name: 'exampleMedicineName' });
    http.post(baseUrl + '/catalog', catalogPayload, { headers: { 'Content-Type': 'application/json' } });

    sleep(1);
};
```

Este script simula uma carga de 10 usu√°rios durante 30 segundos, realizando requisi√ß√µes HTTP GET e POST para endpoints espec√≠ficos da aplica√ß√£o.

## Executando testes de carga com k6

Para executar o script de teste de carga com k6, basta instalar o k6 CLI e executar o comando `k6 run` com o arquivo de script como argumento:

import { Steps } from '@astrojs/starlight/components';

<Steps>

1. Clone o repositorio do projeto e v√° para a pasta `load-test`:
    ```bash
    git clone https://github.com/Inteli-College/2024-1B-T02-EC10-G03.git
    cd 2024-1B-T02-EC10-G03/src/load-test
    ```

2. Instale as depend√™ncias localizadas na pasta `load-test`:
    ```bash
    bun install
    ```

3. Agrupe os arquivos TypeScript:
    ```bash
    # Se tiver o bun instalado
    bun bundle

    # Se n√£o tiver o bun instalado
    npm run bundle
    ```

4. Rode os testes de carga com o k6:
    ```bash
    k6 run api_load_test.ts
    ```

</Steps>

## M√©tricas obtidas utilizando o k6

Rodando o teste para a API desenvolvida, obtivemos as seguintes m√©tricas:

üöß WIP üöß

## Conclus√£o

Os testes de carga desempenham um papel fundamental no desenvolvimento de sistemas robustos e escal√°veis. O framework TypeScript k6 oferece uma maneira eficaz e simplificada de realizar esses testes, permitindo identificar e corrigir problemas de desempenho antes que afetem os usu√°rios finais. Integrar testes de carga em pipelines de CI/CD pode ajudar a garantir que o sistema atenda aos requisitos de performance em cada vers√£o lan√ßada.